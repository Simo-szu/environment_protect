<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>轮播修复测试</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .carousel-card {
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            width: 300px;
            flex-shrink: 0;
            padding: 0 8px;
            transition: all 0.5s ease;
        }
        
        .carousel-card-content {
            border-radius: 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        /* 默认侧边卡片样式 */
        .carousel-card .carousel-card-content {
            width: 280px !important;
            height: 200px !important;
            opacity: 0.7 !important;
            transform: scale(0.9) !important;
            background-color: #ffffff !important;
            border: 2px solid rgba(156, 163, 175, 0.3) !important;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1) !important;
            padding: 1.5rem !important;
        }
        
        /* 中心卡片样式 - 使用更高优先级 */
        .carousel-card.center .carousel-card-content {
            width: 320px !important;
            height: 240px !important;
            opacity: 1 !important;
            transform: scale(1) !important;
            border: none !important;
            padding: 2rem !important;
        }
        
        /* 积分兑换卡片 - 使用更高优先级 */
        .carousel-card[data-type="points"] .carousel-card-content {
            border-color: rgba(240, 163, 47, 0.3) !important;
        }
        .carousel-card[data-type="points"].center .carousel-card-content {
            background-color: #F0A32F !important;
            color: #ffffff !important;
            box-shadow: 0 25px 50px -12px rgba(240, 163, 47, 0.4) !important;
        }
        .carousel-card[data-type="points"] .icon { color: #F0A32F !important; }
        .carousel-card[data-type="points"] .title { color: #F0A32F !important; }
        .carousel-card[data-type="points"] .desc { color: #6b7280 !important; }
        .carousel-card[data-type="points"].center .icon,
        .carousel-card[data-type="points"].center .title,
        .carousel-card[data-type="points"].center .desc { color: #ffffff !important; }
        
        /* 绿色游戏世界卡片 - 使用更高优先级 */
        .carousel-card[data-type="game"] .carousel-card-content {
            border-color: rgba(86, 185, 73, 0.3) !important;
        }
        .carousel-card[data-type="game"].center .carousel-card-content {
            background-color: #56B949 !important;
            color: #ffffff !important;
            box-shadow: 0 25px 50px -12px rgba(86, 185, 73, 0.4) !important;
        }
        .carousel-card[data-type="game"] .icon { color: #56B949 !important; }
        .carousel-card[data-type="game"] .title { color: #56B949 !important; }
        .carousel-card[data-type="game"] .desc { color: #6b7280 !important; }
        .carousel-card[data-type="game"].center .icon,
        .carousel-card[data-type="game"].center .title,
        .carousel-card[data-type="game"].center .desc { color: #ffffff !important; }
        
        /* 权威科普卡片 - 使用更高优先级 */
        .carousel-card[data-type="science"] .carousel-card-content {
            border-color: rgba(48, 73, 155, 0.3) !important;
        }
        .carousel-card[data-type="science"].center .carousel-card-content {
            background-color: #30499B !important;
            color: #ffffff !important;
            box-shadow: 0 25px 50px -12px rgba(48, 73, 155, 0.4) !important;
        }
        .carousel-card[data-type="science"] .icon { color: #30499B !important; }
        .carousel-card[data-type="science"] .title { color: #30499B !important; }
        .carousel-card[data-type="science"] .desc { color: #6b7280 !important; }
        .carousel-card[data-type="science"].center .icon,
        .carousel-card[data-type="science"].center .title,
        .carousel-card[data-type="science"].center .desc { color: #ffffff !important; }
        
        /* 环保活动卡片 - 使用更高优先级 */
        .carousel-card[data-type="activity"] .carousel-card-content {
            border-color: rgba(238, 64, 53, 0.3) !important;
        }
        .carousel-card[data-type="activity"].center .carousel-card-content {
            background-color: #EE4035 !important;
            color: #ffffff !important;
            box-shadow: 0 25px 50px -12px rgba(238, 64, 53, 0.4) !important;
        }
        .carousel-card[data-type="activity"] .icon { color: #EE4035 !important; }
        .carousel-card[data-type="activity"] .title { color: #EE4035 !important; }
        .carousel-card[data-type="activity"] .desc { color: #6b7280 !important; }
        .carousel-card[data-type="activity"].center .icon,
        .carousel-card[data-type="activity"].center .title,
        .carousel-card[data-type="activity"].center .desc { color: #ffffff !important; }
        
        /* 按钮样式 */
        .carousel-button {
            display: none;
            padding: 0.5rem 1rem;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 9999px;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            margin-top: 1rem;
        }
        .carousel-button:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        .carousel-card.center .carousel-button {
            display: block;
            color: #ffffff;
        }
        
        .carousel-indicator {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .carousel-indicator:hover {
            transform: scale(1.2);
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="max-w-6xl mx-auto p-8">
        <h1 class="text-2xl font-bold mb-8 text-center">轮播修复测试</h1>
        
        <!-- 轮播区域 -->
        <section class="relative w-full max-w-6xl mx-auto my-16">
            <div class="flex items-center justify-center gap-4">
                <!-- Left Arrow -->
                <button onclick="moveCarousel(-1)" class="p-3 rounded-full bg-white hover:bg-slate-50 text-slate-300 hover:text-blue-600 transition-all duration-300 border border-slate-100 shadow-sm hover:shadow-md hover:scale-105 group z-10 flex-shrink-0">
                    <i data-lucide="chevron-left" class="w-5 h-5 stroke-[2.5px] group-hover:-translate-x-0.5 transition-transform"></i>
                </button>

                <!-- Carousel Container -->
                <div class="relative w-full max-w-4xl h-80 flex items-center justify-center">
                    <div id="carousel-track" class="flex items-center justify-center gap-4 w-full h-full">
                        <!-- 卡片1: 积分兑换 -->
                        <div class="carousel-card" data-type="points">
                            <div class="carousel-card-content">
                                <i data-lucide="gift" class="w-8 h-8 mb-4 icon"></i>
                                <h3 class="text-lg font-bold mb-2 title">积分兑换</h3>
                                <p class="text-sm mb-4 desc">累积环保值，兑换好礼</p>
                                <button class="carousel-button">立即探索</button>
                            </div>
                        </div>

                        <!-- 卡片2: 绿色游戏世界 (默认中心卡片) -->
                        <div class="carousel-card center" data-type="game">
                            <div class="carousel-card-content">
                                <i data-lucide="gamepad-2" class="w-12 h-12 mb-4 icon"></i>
                                <h3 class="text-xl font-bold mb-2 title">绿色游戏世界</h3>
                                <p class="text-sm mb-4 desc">立即探索</p>
                                <button class="carousel-button">立即探索</button>
                            </div>
                        </div>

                        <!-- 卡片3: 权威科普 -->
                        <div class="carousel-card" data-type="science">
                            <div class="carousel-card-content">
                                <i data-lucide="book-open-check" class="w-8 h-8 mb-4 icon"></i>
                                <h3 class="text-lg font-bold mb-2 title">权威科普</h3>
                                <p class="text-sm mb-4 desc">科学数据，值得信赖</p>
                                <button class="carousel-button">立即探索</button>
                            </div>
                        </div>

                        <!-- 卡片4: 环保活动 (隐藏) -->
                        <div class="carousel-card" data-type="activity" style="display: none;">
                            <div class="carousel-card-content">
                                <i data-lucide="calendar-heart" class="w-8 h-8 mb-4 icon"></i>
                                <h3 class="text-lg font-bold mb-2 title">环保活动</h3>
                                <p class="text-sm mb-4 desc">参与行动，共建未来</p>
                                <button class="carousel-button">立即探索</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Arrow -->
                <button onclick="moveCarousel(1)" class="p-3 rounded-full bg-white hover:bg-slate-50 text-slate-300 hover:text-blue-600 transition-all duration-300 border border-slate-100 shadow-sm hover:shadow-md hover:scale-105 group z-10 flex-shrink-0">
                    <i data-lucide="chevron-right" class="w-5 h-5 stroke-[2.5px] group-hover:translate-x-0.5 transition-transform"></i>
                </button>
            </div>

            <!-- Indicators -->
            <div class="flex justify-center gap-2 mt-6">
                <button class="carousel-indicator w-2 h-2 rounded-full bg-slate-300 transition-all duration-300 hover:scale-125 cursor-pointer" data-slide="0"></button>
                <button class="carousel-indicator w-3 h-2 rounded-full bg-green-500 transition-all duration-300 active hover:scale-125 cursor-pointer" data-slide="1"></button>
                <button class="carousel-indicator w-2 h-2 rounded-full bg-slate-300 transition-all duration-300 hover:scale-125 cursor-pointer" data-slide="2"></button>
                <button class="carousel-indicator w-2 h-2 rounded-full bg-slate-300 transition-all duration-300 hover:scale-125 cursor-pointer" data-slide="3"></button>
            </div>
        </section>

        <div class="text-center mt-8">
            <p class="text-gray-600">当前显示: <span id="current-display">积分兑换, 绿色游戏世界, 权威科普</span></p>
            <p class="text-sm text-gray-500 mt-2">当前中心卡片: <span id="current-center">绿色游戏世界</span></p>
        </div>
    </div>

    <script>
        // 初始化图标
        lucide.createIcons();

        let currentSlide = 1; // 默认显示第二个卡片（绿色游戏世界）
        const totalSlides = 4;
        const cardNames = ['积分兑换', '绿色游戏世界', '权威科普', '环保活动'];

        // 轮播移动函数
        function moveCarousel(direction) {
            console.log('移动轮播:', direction);
            currentSlide = (currentSlide + direction + totalSlides) % totalSlides;
            updateCarouselDisplay();
        }

        // 更新轮播显示
        function updateCarouselDisplay() {
            const cards = document.querySelectorAll('.carousel-card');
            
            console.log('更新轮播显示，当前位置:', currentSlide);
            
            // 重新排列卡片：让当前选中的卡片在中间
            cards.forEach((card, index) => {
                // 计算相对位置：-1(左), 0(中), 1(右)
                let relativePos = (index - currentSlide + totalSlides) % totalSlides;
                if (relativePos > 2) relativePos -= totalSlides; // 处理循环
                
                if (relativePos === -1 || relativePos === 0 || relativePos === 1) {
                    // 显示三张卡片：左、中、右
                    card.style.display = 'flex';
                    
                    if (relativePos === 0) {
                        // 中心卡片
                        card.classList.add('center');
                        
                        // 强制重置样式以确保正确显示
                        const content = card.querySelector('.carousel-card-content');
                        if (content) {
                            // 移除所有可能冲突的内联样式
                            content.removeAttribute('style');
                            // 强制应用中心卡片样式
                            setTimeout(() => {
                                content.style.cssText = '';
                            }, 10);
                        }
                    } else {
                        // 侧边卡片
                        card.classList.remove('center');
                        
                        // 强制重置样式
                        const content = card.querySelector('.carousel-card-content');
                        if (content) {
                            // 移除所有可能冲突的内联样式
                            content.removeAttribute('style');
                            // 强制应用侧边卡片样式
                            setTimeout(() => {
                                content.style.cssText = '';
                            }, 10);
                        }
                    }
                } else {
                    // 隐藏其他卡片
                    card.style.display = 'none';
                    card.classList.remove('center');
                }
            });
            
            // 更新指示器
            const indicators = document.querySelectorAll('.carousel-indicator');
            indicators.forEach((indicator, index) => {
                if (index === currentSlide) {
                    indicator.classList.add('active');
                    indicator.style.width = '12px';
                    indicator.style.backgroundColor = '#10b981';
                } else {
                    indicator.classList.remove('active');
                    indicator.style.width = '8px';
                    indicator.style.backgroundColor = '#cbd5e1';
                }
            });

            // 更新显示信息
            const currentDisplay = document.getElementById('current-display');
            const currentCenter = document.getElementById('current-center');
            
            if (currentDisplay && currentCenter) {
                // 计算显示的三张卡片
                let displayCards = [];
                for (let i = -1; i <= 1; i++) {
                    let cardIndex = (currentSlide + i + totalSlides) % totalSlides;
                    displayCards.push(cardNames[cardIndex]);
                }
                
                currentDisplay.textContent = displayCards.join(', ');
                currentCenter.textContent = cardNames[currentSlide]; // 当前选中的卡片
            }
        }

        // 跳转到指定幻灯片
        function goToSlide(slideIndex) {
            console.log('跳转到幻灯片:', slideIndex);
            currentSlide = slideIndex;
            updateCarouselDisplay();
        }

        // 初始化轮播
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM加载完成，初始化轮播');
            
            // 设置初始显示
            updateCarouselDisplay();
            
            // 添加指示器点击事件
            const indicators = document.querySelectorAll('.carousel-indicator');
            indicators.forEach((indicator, index) => {
                indicator.addEventListener('click', () => {
                    console.log('点击指示器:', index);
                    goToSlide(index);
                });
            });
            
            console.log('轮播初始化完成');
        });
    </script>
</body>
</html>