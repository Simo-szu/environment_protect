# 游戏开发全需求文档

## 一、文档说明

### 1.1 文档目的

明确游戏核心玩法、核心流程、各类判定逻辑、数值设定及技术开发要求,作为技术人员开发、联调、测试的唯一标准;聚焦"原有60张核心卡牌+新增8张政策卡"的适配性,不新增无关玩法,确保开发过程贴合产品设定,降低沟通成本。

### 1.2 核心定义

- **核心卡牌**: 可放置卡牌固定为 card001-card060(共60张),分工业、生态系统、科学、人与社会四大板块,用于地块放置、资源产出/消耗、触发联动效果。
- **政策卡**: 不可放置辅助卡牌固定为 card061-card068(共8张),绑定深圳双碳政策,不占地块、不计入核心卡牌数量,可提供即时/持续效果(可直接影响资源与指标)。
- **核心资源**: 产业值、科创点、人口(三大可积累资源,用于核心卡牌放置、碳交易)。
- **辅助指标**: 绿建度、碳排放、市民满意度、低碳总分(四大指标,用于解锁政策卡、触发事件、校验结局)。
- **全局变量**: 用于存储游戏核心数据(如已放置卡牌数量、各类资源/指标数值、配额、交易记录等),技术需统一管理、实时同步。
- **素材边界**: 以 `卡牌处理完成` 目录为唯一视觉素材基准,当前结局素材为4张、突发事件素材为3张,玩法实现需与素材数量一致。

## 二、游戏核心流程

单局游戏按"开局初始化→回合循环→结局校验→游戏结束"执行,所有玩法(卡牌放置、政策卡使用、事件触发、碳交易、组合技)均嵌入回合循环,不新增额外流程步骤。

### 2.1 开局初始化流程

**技术触发**: 游戏启动后,玩家点击"新游戏"立即执行

#### 1. 全局变量初始化(核心必做)

- **核心资源**: 产业值=30、科创点=20、人口=25(固定值,不随任何设定改变)
- **辅助指标**: 绿建度=50、碳排放=80、市民满意度=60、低碳总分=0(固定初始值)
- **卡牌相关**: 已放置核心卡牌数量=0、剩余核心卡牌数量=60、政策卡库为空、已解锁政策卡数量=0、手牌(核心卡牌=0、政策卡=0)
- **碳交易相关**: 碳排放配额=50、买入总金额=0、卖出总金额=0、碳交易盈利=0
- **其他**: 当前回合=1、当前游戏阶段=前期、事件触发冷却=0、政策卡当前回合使用标记=false

#### 2. 卡池初始化

**核心卡牌分阶段卡池**: 前期20张、中期25张、后期15张(合计严格覆盖 card001-card060,不允许缺号/重号)。

**分池清单(按 `卡牌处理完成` 实际 card ID 固定,直接用于实现)**:
- 前期卡池20张: card001、card002、card003、card004、card011、card012、card021、card022、card023、card024、card027、card028、card036、card037、card044、card046、card047、card048、card050、card055
- 中期卡池25张: card005、card006、card007、card008、card013、card014、card019、card020、card025、card026、card032、card033、card034、card035、card038、card039、card040、card041、card045、card049、card051、card053、card056、card057、card059
- 后期卡池15张: card009、card010、card015、card016、card017、card018、card029、card030、card031、card042、card043、card052、card054、card058、card060

**分池原则(用于后续调平时保持一致)**:
- 前期卡池: 1星卡+低门槛2星卡优先,保证开局可放置率和基础资源启动。
- 中期卡池: 常规2星主力卡为核心,承担策略成型与板块过渡。
- 后期卡池: 3星卡与关键策略卡(如card054、card060)集中,用于结局冲刺。

**实施约束(必做)**:
- 三阶段卡池必须合计且仅包含 card001-card060。
- 历史版本中作为关键判定条件的 card054、card060 必须可抽取(当前方案已归入后期卡池)。
- 卡池分配以 `卡牌处理完成/卡牌` 资源编号为准,文档与实现保持同一编号体系。
- 阶段归属使用独立字段 `phase_bucket`(early/mid/late),不得通过改 cardID 实现分池。

- **政策卡池**: 初始化8张政策卡清单(仅存储,不加入玩家卡库,需满足解锁条件后加入)。政策卡统一使用 card 编号,为 card061-card068:
- card061 低碳产业补贴政策
- card062 工业碳减排管控政策
- card063 生态碳汇提升政策
- card064 红树林保护专项政策
- card065 科创低碳扶持政策
- card066 碳捕捉技术推广政策
- card067 甜甜圈社区建设政策
- card068 市民低碳参与激励政策

#### 3. 首次发牌

按随机发牌规则,从前期卡池抽取4张核心卡牌,写入玩家核心卡牌手牌(手牌上限6张,首次发牌无超出情况)

#### 4. 界面同步

初始化后,实时同步所有全局变量至前端界面(如资源数值、手牌、回合数、配额等)


### 2.2 回合循环流程

**核心链路,每回合重复执行,直到触发结局条件**

单回合执行顺序: 当前回合开始→抽牌阶段→选卡放置阶段→政策卡使用阶段(可选)→组合技判定阶段→结算阶段→事件触发判定→碳交易窗口判定(双回合触发)→结局校验→当前回合结束(回合+1)

#### 步骤1: 当前回合开始

**触发时机**: 上一回合结束后,自动进入

- **重置标记**: 政策卡当前回合使用标记=false、组合技本回合触发标记=0(最多触发2种)
- **阶段判定**: 读取"已放置核心卡牌数量""低碳总分",更新当前游戏阶段(前期/中期/后期),同步切换对应核心卡牌卡池
- **冷却更新**: 事件触发冷却=事件触发冷却-1(初始为0,每回合递减,用于控制每3回合触发1次事件)

#### 步骤2: 抽牌阶段

**触发时机**: 当前回合开始后,自动执行

- **核心卡牌抽牌**: 按当前游戏阶段调整抽牌数量,从对应阶段卡池随机抽取,按随机发牌规则、概率调整机制执行,加入玩家核心卡牌手牌:
  - 前期(当前游戏阶段=前期): 每回合抽取4张(适配开局资源匮乏、快速上手需求)
  - 中期(当前游戏阶段=中期): 每回合抽取3张(控制卡牌获取速度,强化策略选择,适配中期资源积累场景)
  - 后期(当前游戏阶段=后期): 每回合抽取2张(提升高阶卡牌稀缺性,强化后期策略博弈感,避免选择冗余)

- **政策卡抽牌**: 若已解锁政策卡数量≥1,额外从已解锁政策卡库随机抽取1张,加入玩家政策卡手牌(手牌上限2张)

- **手牌上限处理**: 若抽牌后核心卡牌手牌>6张、政策卡手牌>2张,触发弃置逻辑(玩家必须手动弃置至上限以内后才能继续操作);弃置的卡牌直接作废,不返回任何卡池,不再参与后续抽牌

- **特殊场景**: 若剩余核心卡牌≤对应阶段抽牌数量,抽牌数量=剩余核心卡牌数量;若当前阶段卡池卡牌耗尽,从下一阶段卡池补充抽取

#### 步骤3: 选卡放置阶段

**触发时机**: 抽牌阶段结束后,玩家主动操作

- **核心卡牌放置判定**: 玩家选择手牌中1张核心卡牌,技术需判定2个条件:
  1. 目标地块为空白地块(未放置任何核心卡牌,对角线不算相邻,仅上下左右为相邻地块)
  2. 玩家当前核心资源满足该卡牌消耗要求

- **放置结果处理**:
  - 判定通过: 卡牌放置成功,更新全局变量(已放置核心卡牌数量+1、剩余核心卡牌数量-1、消耗对应核心资源),同步更新前端地块显示
  - 判定失败: 卡牌返回手牌,弹出提示(地块已占用/资源不足),不消耗任何资源、不改变全局变量

- **限制**: 每回合玩家最多放置1张核心卡牌(不可多放);政策卡不可放置,仅可在后续步骤使用

#### 步骤4: 政策卡使用阶段

**触发时机**: 选卡放置阶段结束后,玩家主动操作,可选

- **使用判定**: 玩家选择手牌中1张政策卡,技术需判定2个条件:
  1. 该政策卡已解锁
  2. 政策卡当前回合使用标记=false(每回合最多使用1张)

- **使用结果处理**:
  - 判定通过: 政策卡使用成功,触发对应效果(即时/持续3回合),更新全局变量(持续效果需添加持续回合标签),标记政策卡当前回合使用标记=true,卡牌返回政策卡库(可重复使用)
  - 判定失败: 卡牌返回手牌,弹出提示(未解锁/当前回合已使用政策卡),不改变任何全局变量

- **效果限制**: 同一类型政策卡不可同时生效,后使用的覆盖前使用的;政策卡效果可与其他所有效果叠加(按优先级规则)

#### 步骤5: 组合技判定阶段

**触发时机**: 政策卡使用阶段结束后,自动执行(本回合未使用政策卡时,仅判定核心卡组合技)

- **判定顺序**: 按"卡牌+政策卡组合技>跨板块组合技>板块内组合技"的优先级,依次判定是否满足触发条件
- **触发限制**: 每回合最多触发2种组合技,触发后标记对应组合技,本回合不再重复判定
- **效果处理**: 触发成功后,记录组合技效果(写入全局变量"卡牌效果"),用于后续结算阶段叠加计算,效果持续1回合

#### 步骤6: 结算阶段

**触发时机**: 组合技判定结束后,自动执行,核心是更新各类资源/指标数值

- **核心卡牌效果结算**: 读取所有已放置核心卡牌的基础效果,叠加组合技效果,更新核心资源(产业值、科创点、人口)和辅助指标(绿建度、碳排放、市民满意度)

- **政策卡效果结算**: 若有持续生效的政策卡,读取其效果,叠加至对应资源/指标,同时更新政策卡持续回合(每结算1次,持续回合-1,回合数=0时效果消失,移除对应标记)

- **碳排放配额结算**: 结算后检测当前碳排放数值,若碳排放>80,每超出10点消耗1份配额(向下取整),更新配额全局变量;配额不足时,仅标记,不额外惩罚

- **低碳总分结算**: 根据当前核心资源、辅助指标数值,按固定公式计算低碳总分(公式沿用原有设定,不新增),更新全局变量

- **日志留存**: 结算后,留存所有数值变化日志(含原有数值、变化量、最终数值),用于问题排查

#### 步骤7: 事件触发判定

**触发时机**: 结算阶段结束后,自动执行

- **触发条件**: 事件触发冷却≤0(即每3回合触发1次),基础触发概率30%
- **事件类型判定**: 当前版本仅包含3种负向突发事件(内涝/海平面上升/市民抗议),先按阈值筛选候选事件,再按固定30%触发;若同回合命中多个候选事件,按风险权重抽取1个(海平面上升40%、内涝35%、市民抗议25%)
- **事件效果处理**: 触发后立即更新对应资源/指标,添加事件效果标签(持续1-2回合),弹出前端提示(含事件类型、效果、化解方式);若玩家在后续回合使用对应政策卡,可立即抵消事件效果

- **重置冷却**: 事件触发后(无论是否触发成功),重置事件触发冷却=3

#### 步骤8: 碳交易窗口判定

**触发时机**: 事件触发判定结束后,自动执行(每2回合开启1次)

- **触发规则**: 回合2、4、6...开启交易机会;当回合内玩家可自行决定是否交易,结束回合仍未交易视为放弃
- **处理规则**: 按3.7碳交易逻辑进行买入/卖出判定、盈利更新与提示反馈

#### 步骤9: 结局校验

**触发时机**: 碳交易窗口判定结束后,自动执行,核心终止条件

- **校验逻辑**: 读取当前全局变量(低碳总分、核心资源、辅助指标、碳交易盈利等),按固定优先级对比4类结局条件(失败结局→创新科技结局→生态优先结局→甜甜圈结局)

- **校验结果处理**:
  - 达成结局: 终止回合循环,进入结局展示阶段(展示结局名称、达成条件、游戏数据统计),游戏结束
  - 未达成结局: 进入下一回合,重复回合循环流程

- **边界校验**: 终局判定触发条件为"剩余核心卡牌=0"或"当前回合=30";若未满足其余3类正向结局,统一进入失败结局

#### 步骤10: 当前回合结束

**触发时机**: 结局校验未达成后,自动执行

- **更新全局变量**: 当前回合=当前回合+1
- **界面同步**: 实时同步所有全局变量至前端界面,准备进入下一回合


### 2.3 结局展示与游戏结束流程

1. **结局展示**: 达成结局后,展示结局名称、达成条件、游戏核心数据(已放置卡牌数量、各类资源/指标最终数值、碳交易盈利、政策卡使用记录等),展示时长可配置(默认5秒,玩家可点击跳过)

2. **游戏结束**: 结局展示完成后,提供"重新开始""退出游戏"两个选项,点击后重置所有全局变量(重新开始)或关闭游戏进程(退出游戏)

3. **异常处理**: 游戏重连/重启时,读取当前全局变量(回合数、资源、手牌、已放置卡牌等),恢复至重连/重启前的游戏状态,避免数据丢失

### 2.4 结局核心判定指标——低碳总分

低碳总分仅作为后台核心判定指标,用于校验游戏结局(不展示给玩家),具体计算标准说明如下:

低碳总分初始值为0点(所有玩家开局一致),全程由系统后台自动计算、每回合结算后同步更新,不向玩家展示任何数值及变化,仅用于结局触发判定,具体计算细则:

1. **板块卡牌加分(核心加分项)**: 四大板块(工业、生态、科学、人与社会)每放置1张核心卡牌,加1点;放置高阶卡牌(后期15张),每张加2点;四大板块每有一个板块卡牌≥8张,额外加5点(均衡布局奖励)

2. **政策卡加分**: 每解锁1张政策卡,加3点;解锁全部8张政策卡,额外加10点(全政策奖励)

3. **事件触发加减分**: 触发1次负向事件(内涝/海平面上升/市民抗议),扣10点;成功化解1次负向事件,加10点

4. **碳排放加减分(核心影响项)**: 每回合碳排放≤70点(低碳达标),加3点;碳排放71-80点(合格),不加分不扣分;碳排放81-100点(轻微超标),每回合扣2点;碳排放101-130点(中度超标),每回合扣5点;碳排放>130点(重度超标),每回合扣8点;连续3回合超标,额外扣15点

5. **碳交易相关加减分**: 碳交易盈利每累计50点,加3点;每出现1次配额耗尽记录,扣5点;碳交易出现违规操作,每次扣8点

**补充**: 总分无上限,最低为0点(不会出现负分);所有加减分均在每回合结算后后台自动生效,不向玩家展示任何计算过程及结果;仅用于结局触发判定,不影响玩家前端任何操作

### 2.5 游戏结局种类说明

本章节以 `卡牌处理完成/结局` 素材为唯一实现基准。当前版本仅实现4类结局:
- 创新科技结局(`创新科技结局.jpg`)
- 生态优先结局(`生态优先结局.jpg`)
- 甜甜圈结局(`甜甜圈结局.jpg`)
- 失败结局(`失败结局.jpg`)

当前生效的结局判定规则如下:

1. **终局触发条件**: 剩余核心卡牌=0,或当前回合达到30回合。
2. **判定优先级**: 失败结局 > 创新科技结局 > 生态优先结局 > 甜甜圈结局。
3. **创新科技结局条件(同时满足)**: 科学板块卡牌数为四板块最高且≥14;科创点≥220;低碳总分≥170;碳排放≤95;碳交易盈利≥120;负向事件化解率≥70%。
4. **生态优先结局条件(同时满足)**: 生态板块卡牌数为四板块最高且≥14;绿建度≥140;碳排放≤70;剩余配额≥30;低碳总分≥170;负向事件化解率≥70%。
5. **甜甜圈结局条件(同时满足)**: 人与社会板块卡牌数为四板块最高且≥12;市民满意度≥92;人口≥110;四板块最小卡牌数≥8;碳排放≤80;低碳总分≥165;card067或card068累计使用次数≥3。
6. **失败结局条件(满足任一)**: 连续5回合碳排放>130(即时失败);或配额耗尽记录≥4且碳交易盈利<0;或终局时低碳总分<120。


## 三、核心判定逻辑

### 3.1 游戏阶段判定逻辑

联动回合循环步骤1

| 游戏阶段 | 判定条件(同时满足) | 核心处理(技术必做) |
|---------|-------------------|-------------------|
| 前期 | 已放置核心卡牌≤15张 + 低碳总分<60 | 切换至前期核心卡牌卡池,后续抽牌从该卡池抽取 |
| 中期 | 已放置核心卡牌16-30张 + 低碳总分60-100 | 切换至中期核心卡牌卡池,后续抽牌从该卡池抽取;前期卡池剩余卡牌转入中期卡池 |
| 后期 | 已放置核心卡牌≥31张 + 低碳总分≥101 或 剩余核心卡牌≤10张 | 切换至后期核心卡牌卡池,后续抽牌从该卡池抽取;中期卡池剩余卡牌转入后期卡池 |

**技术注意**: 每回合结束后,需重新执行阶段判定,确保阶段切换及时;阶段切换后,抽牌逻辑自动适配新卡池,无需玩家主动操作。

### 3.2 随机发牌判定逻辑

联动回合循环步骤2

#### 3.2.1 基础判定规则

- **发牌数量**: 核心卡牌按游戏阶段调整(前期每回合4张、中期每回合3张、后期每回合2张);已解锁政策卡≥1时,额外发1张政策卡
- **手牌上限**: 核心卡牌6张、政策卡2张,超出部分需弃置(玩家主动/自动);弃置的卡牌直接作废,不返回任何卡池
- **抽牌范围**: 核心卡牌从当前阶段卡池抽取;政策卡从已解锁政策卡库抽取(未解锁的不参与)

#### 3.2.2 概率调整判定(避免卡牌过度集中/稀缺)

**1. 核心卡牌概率调整(每回合发牌前执行)**

- **基础概率**: 当前阶段卡池内,四大板块卡牌抽取概率=该板块卡牌数量/当前卡池总卡牌数量
- **调整规则**:
  - 某板块已放置卡牌≥当前已放置总卡牌数的40%: 该板块卡牌抽取概率降低10%
  - 某板块已放置卡牌≤当前已放置总卡牌数的10%: 该板块卡牌抽取概率提升10%

**2. 政策卡概率调整(每回合发牌前执行)**

- **基础概率**: 单张政策卡抽取概率=1/已解锁政策卡数量(已解锁n张,每张概率1/n)
- **限制**: 已解锁政策卡数量越多,单张抽取概率越低,避免某张政策卡过度使用

#### 3.2.3 特殊场景判定

- **卡池耗尽**: 当前阶段卡池无剩余卡牌时,自动从下一阶段卡池抽取,概率按下一阶段卡池规则执行
- **回合末期**: 剩余核心卡牌≤对应阶段抽牌数量时,抽牌数量=剩余核心卡牌数量,直至抽完所有核心卡牌;弃置的卡牌直接作废,不参与后续抽牌
- **重连/重启**: 恢复当前回合抽牌状态(已抽牌数量、手牌、弃置记录),不重复发牌、不丢失卡牌;已弃置的作废卡牌不恢复

### 3.3 卡牌通用判定逻辑

适配所有核心卡牌、政策卡

#### 3.3.0 ID与编号规范

- **主键ID**: 全量卡牌统一使用 `card001-card068` 字符串ID,作为唯一主键,全生命周期不可变更。
- **类型分段**: `card001-card060` 固定为核心卡牌,`card061-card068` 固定为政策卡;该分段仅用于类型识别,不用于阶段判定。
- **显示序号**: UI如需数字展示,通过 `card_no`(int)由ID解析得到,禁止直接修改或重排 cardID。
- **阶段归属**: 前/中/后期通过 `phase_bucket` 字段维护,允许平衡性迭代时调整该字段,但不允许改ID。
- **兼容要求**: 存档、日志、埋点、结算、配置表全部以 cardID 关联,避免因中文名改动导致兼容问题。

#### 3.3.1 标签统一规范

**核心卡牌标签(必带+可选)**

- **必带标签**: 板块标签(industry/ecology/science/society,对应四大板块)、类型标签(basic/advanced/high-level,对应基础/进阶/高阶)
- **可选标签**: low-carbon(低碳)、shenzhen(深圳特色)、link(联动类)
- **标签叠加规则**: 三类可选标签可相互叠加(如card006同时携带low-carbon+shenzhen标签,card009同时携带low-carbon+link标签),不与必带标签冲突,技术需支持多标签同时匹配

**政策卡标签(必带)**

- **必带标签**: 关联板块标签(单板块/双板块,如industry、science+industry)、效果类型标签(immediate/continuous,对应即时/持续)

**标签命名**: 统一为英文小写,无中文、无特殊符号,技术层面按标签匹配执行判定逻辑

#### 3.3.2 核心卡牌(可放置)判定逻辑

**1. 放置判定(联动回合循环步骤3)**

- **判定条件**: 目标地块空白(未放置任何核心卡牌) + 核心资源满足卡牌消耗要求
- **失败处理**: 卡牌返回手牌,弹出提示,不消耗资源、不改变全局变量

**2. 效果判定(联动回合循环步骤5)**

- **触发时机**: 放置成功后,立即记录基础效果参与本回合结算;组合技在政策卡使用阶段结束后统一判定触发
- **效果持续**: 直至游戏结束(除非被特殊事件、其他卡牌效果抵消)

**3. 移除判定**

- 不可主动移除,仅可被负向特殊事件移除(如"内涝"触发时移除1张生态卡牌效果)
- **移除后**: 卡牌效果同步消失,已消耗的资源不返还,更新全局变量(已放置核心卡牌数量-1)

#### 3.3.3 政策卡(不可放置)判定逻辑

**1. 解锁判定(联动核心流程,实时执行)**

- **判定条件**: 每张政策卡对应专属解锁条件(量化阈值,见3.4),满足条件后自动加入玩家政策卡库
- **解锁后处理**: 更新全局变量(已解锁政策卡数量+1),同步前端政策卡库显示,后续抽牌可抽取该政策卡

**2. 使用判定(联动回合循环步骤4)**

- **判定条件**: 已解锁 + 当前回合未使用政策卡(使用标记=false)
- **失败处理**: 卡牌返回手牌,弹出提示,不改变任何全局变量

**3. 效果判定**

- **即时效果**: 使用后立即触发,仅影响当前结算后的资源/指标,无持续回合
- **持续效果**: 使用后持续3回合,每回合结算时触发,持续回合数=0时效果消失,移除对应标记

**4. 叠加与抵消判定**

- **叠加**: 不同类型政策卡效果可叠加,数值直接累加
- **抵消**: 同一类型政策卡,后使用的覆盖前使用的;政策卡效果可被负向特殊事件、其他政策卡效果抵消,抵消后剩余持续回合作废

#### 3.3.4 卡牌效果优先级判定(避免效果冲突)

- **优先级(从高到低)**: 特殊事件效果 > 政策卡效果 > 组合技效果 > 核心卡牌基础效果
- **冲突处理(联动回合循环步骤5)**:
  - 高优先级抵消低优先级: 如负向特殊事件效果可抵消核心卡牌基础效果
  - 同优先级处理: 正向与负向效果相互抵消(数值相减),正向与正向效果叠加(数值相加)
- **技术逻辑**: 回合结算时,按优先级顺序读取所有效果,依次计算、抵消、叠加,输出最终数值,留存结算日志


### 3.4 政策卡解锁判定逻辑

政策卡总量固定为8张(card061-card068);单局可解锁上限为8张,解锁后可重复使用

| 政策卡名称 | 关联板块 | 解锁触发条件(同时满足) | 使用效果(即时+持续) | 持续时长 | 可化解负向事件 | 组合技联动效果 |
|-----------|---------|----------------------|-------------------|---------|--------------|--------------|
| 《低碳产业补贴政策》 | 工业 | 工业卡牌≥6张 + 产业值≥50 | 即时:产业值+15、工业卡牌碳排放-8点<br>持续:每回合工业产业值+5 | 3回合 | 无 | 工业低碳标签卡牌≥3张:额外碳排放-15、产业值+10 |
| 《工业碳减排管控政策》 | 工业 | 工业卡牌≥8张 + 碳排放≥100 | 即时:碳排放-30、工业卡牌碳排放降10%<br>持续:每回合抵消工业碳排放+5点 | 3回合 | 海平面上升 | 工业卡牌≥5张:额外碳排放-20、配额+3 |
| 《生态碳汇提升政策》 | 生态系统 | 生态卡牌≥6张 + 绿建度≥70 | 即时:绿建度+20、市民满意度+8<br>持续:每回合绿建度+3、碳排放-4点 | 3回合 | 内涝 | 生态卡牌≥3张:额外绿建度+10、碳汇加分+5 |
| 《红树林保护专项政策》 | 生态系统 | 生态深圳特色卡牌≥2张 | 即时:绿建度+15、碳排放配额+3<br>持续:每回合生态碳汇效果提升15% | 3回合 | 无 | 生态深圳特色卡牌≥2张:额外绿建度+10、配额+2/回合 |
| 《科创低碳扶持政策》 | 科学 | 科学卡牌≥6张 + 科创点≥70 | 即时:科创点+25、组合技触发概率+10%<br>持续:每回合科创点+6、科学卡牌效果+12% | 3回合 | 无 | 科学卡牌≥3张:额外科创点+15、组合技效果+10% |
| 《碳捕捉技术推广政策》 | 科学+工业 | 科学卡牌≥5张 + 工业卡牌≥5张 + 科创点≥80 | 即时:碳排放-40、科创点+20<br>持续:每回合跨板块卡牌碳排放-8点 | 3回合 | 无 | 科+工卡牌各≥3张:额外碳排放-25、科创点+10 |
| 《甜甜圈社区建设政策》 | 人与社会+生态 | 人社卡牌≥5张 + 生态卡牌≥5张 + 市民满意度≥75 | 即时:市民满意度+20、人口+10<br>持续:每回合人口+3、市民满意度+4 | 3回合 | 无 | 人社+生态各≥2张:额外市民满意度+15、人口产出+20% |
| 《市民低碳参与激励政策》 | 人与社会 | 人社卡牌≥6张 + 人口≥60 | 即时:市民满意度+18、人口+8<br>持续:每回合市民满意度+5、低碳总分+2 | 3回合 | 市民抗议 | 人社卡牌≥3张:额外人口+5、低碳总分+3/回合 |

### 3.5 组合技触发判定逻辑

#### 3.5.1 基础触发规则

- **触发时机**: 每回合政策卡使用阶段结束后、结算前,自动执行
- **判定优先级**: 卡牌+政策卡组合技 > 跨板块组合技 > 板块内组合技
- **触发限制**: 每回合最多触发2种组合技,效果持续1回合,结算后自动消失
- **判定基础**: 按卡牌标签、已放置卡牌数量、相邻关系(仅上下左右)执行判定

#### 3.5.2 各类组合技具体判定(量化条件,技术可直接落地)

**1. 板块内组合技(4种,仅核心卡牌联动)**

- **低碳工业集群(工业)**: 工业板块low-carbon标签卡牌≥4张 + 相邻放置≥3张 → 效果:工业产业值+30%、碳排放-15点/回合
- **生态碳汇集群(生态)**: 生态板块卡牌≥4张 + shenzhen标签卡牌≥1张 → 效果:绿建度+12、市民满意度+8、碳排放-8点/回合
- **科创研发集群(科学)**: 科学板块卡牌≥4张 + 相邻放置≥2张 → 效果:科创点+35%、所有板块低碳分数+8%
- **低碳社区集群(人与社会)**: 人与社会板块卡牌≥4张 + 与生态板块卡牌相邻≥2张 → 效果:人口产出+25%、市民满意度+10

**2. 跨板块组合技(4种,仅核心卡牌联动)**

- **科创+工业**: 科学板块卡牌≥3张 + 工业low-carbon标签卡牌≥3张 + 相邻放置 → 效果:产业值+20、科创点+15、碳排放-20
- **生态+工业**: 生态板块卡牌≥3张 + 工业板块卡牌≥3张 + 相邻放置 → 效果:工业碳排放-25、绿建度+10
- **生态+人与社会**: 生态板块卡牌≥3张 + 人与社会板块卡牌≥3张 + 相邻放置≥2对 → 效果:市民满意度+15、人口+8、绿建度+8
- **科学+生态**: 科学板块卡牌≥3张 + 生态板块卡牌≥3张 + link标签卡牌≥1张 → 效果:绿建度+15、科创点+10、配额+2/回合

**3. 卡牌+政策卡组合技**

- **触发基础**: 解锁对应政策卡 + 放置对应板块核心卡牌≥3张 + 使用该政策卡 → 效果叠加政策卡本身效果
- **示例**(其余4种逻辑一致,技术批量复用):
  - 《低碳产业补贴政策》+ 工业low-carbon卡牌≥3张:额外碳排放-15、产业值+10
  - 《红树林保护专项政策》+ 生态shenzhen卡牌≥2张:额外绿建度+10、生态碳汇加分+5
  - 《科创低碳扶持政策》+ 科学板块卡牌≥3张:额外科创点+15、联动效果+10%
  - 《甜甜圈社区建设政策》+ 人与社会+生态卡牌各≥2张:额外市民满意度+15、人口产出+20%

### 3.6 特殊事件触发判定逻辑(当前版本3种,全部为负向)

#### 3.6.1 基础触发规则

- **触发时机**: 每回合结算后,自动执行(事件触发冷却≤0)
- **触发概率**: 固定30%(当前版本不做动态上调或下调)
- **效果持续**: 负向事件持续1-2回合(具体见下表),可通过对应政策卡化解
- **判定优先级**: 低于结局校验,且在本回合结算完成后执行

#### 3.6.2 具体事件判定(量化条件+技术处理)

| 事件类型 | 事件名称 | 触发判定条件(量化) | 效果及持续时间 | 技术处理(必做) |
|---------|---------|-------------------|--------------|--------------|
| 负向事件 | 内涝 | 绿建度≤75 且 当前回合为偶数(满足则进入候选池,不改变30%总概率) | 绿建度-10、当回合生态类效果-20%,持续1回合 | 添加"内涝"标签;检测到《红树林保护专项政策》或《生态碳汇提升政策》使用,立即移除标签并抵消后续效果 |
| 负向事件 | 海平面上升 | 碳排放≥95(满足则进入候选池,不改变30%总概率) | 碳排放+15、额外配额消耗+2,持续1回合 | 添加"海平面上升"标签;检测到《工业碳减排管控政策》或《碳捕捉技术推广政策》使用,立即移除标签并抵消后续效果 |
| 负向事件 | 市民抗议 | 市民满意度≤70 或 人口≥100(满足则进入候选池,不改变30%总概率) | 市民满意度-12、人口产出-15%,持续2回合 | 添加"市民抗议"标签;检测到《甜甜圈社区建设政策》或《市民低碳参与激励政策》使用,立即移除标签并抵消后续效果 |


### 3.7 碳交易市场判定逻辑

#### 3.7.1 基础设定

- **配额初始值**=50份,可交易、可储备,不可为负数;交易标的仅为碳排放配额
- **交易价格**: 基础价=2产业值/份,每回合波动±20%,叠加碳排放影响(碳排放>100→+10%,<60→-10%)
- **交易窗口**: 每2回合开启1次(回合2、4、6...),当回合内不限时,玩家在结束回合前可选执行1次交易,未交易视为放弃

#### 3.7.2 核心判定逻辑

**1. 配额消耗判定(联动回合循环步骤5)**

- **判定公式**: 配额消耗数量=向下取整((当前碳排放-80)/10),仅当碳排放>80时计算
- **处理**: 更新配额全局变量(配额=配额-消耗数量);配额不足时,不消耗,仅标记"配额不足"

**2. 交易窗口触发判定**

- **触发时机**: 每2回合结束后、结局校验前,前端标记当回合可交易状态
- **价格计算**: 当前交易价格=基础价×(1+随机波动±20%)×(1+碳排放影响±10%),保留1位小数

**3. 买入/卖出判定**

- **买入判定**: 产业值≥买入数量×当前价格 + 买入后配额≤200(上限)→ 判定通过,扣除产业值、增加配额,更新买入总金额
- **卖出判定**: 配额≥卖出数量 + 卖出后配额≥0 → 判定通过,增加产业值、扣除配额,更新卖出总金额
- **失败处理**: 弹出提示(产业值不足/配额不足/配额超上限),不执行任何交易操作

**4. 碳交易盈利判定(联动结局校验)**

- **盈利计算**: 碳交易盈利=卖出总金额-买入总金额(实时更新,写入全局变量)
- **结局适配**: 碳交易盈利与配额表现直接作为4类结局判定输入,不再单独定义碳交易专属结局

## 四、视觉设计要求

### 4.1 政策卡视觉设计规范

#### 4.1.1 整体风格定位

- **风格统一**: 与现有60张核心卡牌保持一致,尺寸统一
- **视觉区分**: 为突出"政策属性+深圳双碳特色",可通过边框、底色轻微差异区分(不突兀),便于玩家快速识别
- **设计原则**: 图标简洁、不复杂,突出政策主题,避免视觉过载

#### 4.1.2 8张政策卡具体设计要求

| 政策卡名称 | 关联板块 | 解锁判定条件(量化) | 视觉设计补充说明 |
|-----------|---------|-------------------|----------------|
| 《低碳产业补贴政策》 | 工业 | 工业板块卡牌≥6张 + 产业值≥50 | 突出"低碳工业+补贴",图标简洁,不复杂 |
| 《工业碳减排管控政策》 | 工业 | 工业板块卡牌≥8张 + 碳排放≥100 | 贴合"碳减排",视觉上突出"绿色、管控" |
| 《生态碳汇提升政策》 | 生态系统 | 生态系统板块卡牌≥6张 + 绿建度≥70 | 贴合生态主题,绿植图标可选用深圳常见植被(如红树林简化版) |
| 《红树林保护专项政策》 | 生态系统 | 生态系统板块深圳特色卡牌≥2张 | 突出深圳特色,红树林图标简化,易识别 |
| 《科创低碳扶持政策》 | 科学 | 科学板块卡牌≥6张 + 科创点≥70 | 突出"科创+低碳",科技感适中,不浮夸 |
| 《碳捕捉技术推广政策》 | 科学+工业 | 科学板块卡牌≥5张 + 工业板块卡牌≥5张 + 科创点≥80 | 双板块融合,渐变底色自然,图标突出"捕捉"功能 |
| 《甜甜圈社区建设政策》 | 人与社会+生态 | 人与社会板块卡牌≥5张 + 生态系统板块卡牌≥5张 + 市民满意度≥75 | 贴合"社区+生态",甜甜圈图形简洁,不遮挡核心图标 |
| 《市民低碳参与激励政策》 | 人与社会 | 人与社会板块卡牌≥6张 + 人口≥60 | 突出"市民参与",人物图标可爱、简约,贴合民生主题 |

### 4.2 回合过渡动画设计规范

#### 4.2.1 动画基础设定

- **动画基础**: 极简深圳轮廓地图
- **动画时长**: 1.5-2秒
- **触发逻辑**: 与5个核心指标变化联动,按指标增量/减量判定播放对应动画
- **设计原则**: 简约、不抢视觉焦点、突出正向反馈、避免负面视觉

#### 4.2.2 7类回合过渡动画具体设计

| 动画类别 | 触发条件 | 具体内容(仅供参考) | 色彩(仅供参考) | 补充说明 |
|---------|---------|-------------------|--------------|---------|
| 1. 产业值成长动画 | 本回合产业值增加≥8,且增量>其他4项指标增量 | 建筑拔地而起:<br>- 增幅高(≥12)→ 2-3栋更高的地标建筑从地图地面缓慢升起<br>- 增幅中(8-11)→ 2-3栋楼房简化版升起<br>动画节奏轻快,无复杂细节 | 主体:现代蓝、银灰色<br>边框/点缀:深灰色 | 建筑图标简化,避免细节过多,与深圳地域特色贴合 |
| 2. 绿建度提升动画 | 本回合绿建度增加≥6,且增量>其他4项指标增量 | 城市生态生长:<br>- 增幅高(≥10)→ 地图对应区域长出成片绿植、红树林简化图标(成片分布)<br>- 增幅中(6-9)→ 零星绿植、红树林图标<br>- 绿建度下降≥5→ 对应区域绿植轻微枯黄、淡入淡出消失 | 主体:清新绿、嫩绿色<br>点缀:深绿色 | 绿植、红树林图标简化,贴合深圳生态特色,生长动画自然 |
| 3. 科创点爆发动画 | 本回合科创点增加≥8,且增量>其他4项指标增量 | 科技微光漂浮:<br>- 增幅高(≥12)→ 地图上弹出多个简约芯片、光伏板图标,搭配微光特效(淡蓝色微光),缓慢上浮后消失<br>- 增幅中(8-11)→ 少量芯片、光伏板图标+微光<br>图标数量随增幅提升而增加 | 主体:科技蓝、浅紫色<br>微光:淡蓝色 | 科技图标简化,微光特效柔和,不刺眼,突出"低碳科创" |
| 4. 市民满意度提升动画 | 本回合市民满意度增加≥6,且增量>其他4项指标增量 | 民生宜居反馈:<br>- 增幅高(≥10)→ 地图上随机散布多个简约人物图标、笑脸标识(大小一致),缓慢闪烁后消失<br>- 增幅中(6-9)→ 少量人物+笑脸图标<br>- 满意度下降≥5→ 笑脸变为中性表情,数量减少 | 主体:暖黄色、橙色<br>笑脸:淡黄色 | 人物、笑脸图标可爱简约,分布均匀,不遮挡地图轮廓 |
| 5. 碳排放优化动画 | 本回合碳排放下降≥8,且下降幅度>其他指标增量 | 减碳视觉反馈:<br>- 下降幅度高(≥12)→ 地图上少量灰色烟雾(简约线条)缓慢消散,替换为绿色气流/叶子图标(向上漂浮)<br>- 碳排放上升≥10→ 少量灰色烟雾(简约线条,不突兀、不负面),缓慢淡入淡出<br>- 下降幅度中(8-11)→ 少量绿色气流 | 灰色烟雾:浅灰色<br>绿色气流/叶子:清新绿 | 烟雾、气流图标简化,避免负面视觉,突出"减碳成功"的正向反馈 |
| 6. 均衡发展动画 | 以上5类动画均不满足时,默认播放 | 城市平稳发展:<br>深圳轮廓地图整体轻微亮一下(淡白色微光),地图边缘出现一圈细线条光晕(与地图底色同色系),体现平稳推进 | 主体:浅白色、淡灰色<br>光晕:浅灰色 | 最简化设计,不抢视觉焦点,仅作为回合过渡的兜底效果 |
| 7. 碳排放灾难动画 | 本回合碳排放增加≥20,且无对应减碳措施 | 污染警示:<br>地图局部出现较多灰色烟雾(简约线条),缓慢扩散后淡去,搭配轻微震动效果(不强烈),无其他多余元素 | 主体:深灰色、浅黑色<br>点缀:暗红色(微弱警示) | 风格简约,不刻意营造恐怖感,仅体现"排放超标"警示 |

#### 4.2.3 动画技术要求

- **性能优化**: 动画需轻量化,避免卡顿,确保在低配设备上流畅播放
- **可配置性**: 玩家可在设置中关闭/开启回合过渡动画,默认开启
- **优先级判定**: 当多个指标同时满足触发条件时,按"产业值>绿建度>科创点>市民满意度>碳排放"优先级播放,仅播放1种动画
- **特殊场景**: 碳排放灾难动画优先级最高,触发时覆盖其他所有动画


## 五、核心判定逻辑速查表

说明: 速查表聚焦核心量化阈值、触发条件及关键处理,与前文判定逻辑完全一致,供快速查阅,无需翻阅全文。

| 判定类型 | 核心判定条件(量化) | 触发时机/关键处理 | 关联模块 |
|---------|-------------------|------------------|---------|
| 游戏阶段 | 前期:已放置核心卡牌≤15张 + 低碳总分<60 | 每回合开始时判定,切换至前期卡池抽牌 | 回合循环步骤1 |
| 游戏阶段 | 中期:已放置核心卡牌16-30张 + 低碳总分60-100 | 每回合开始时判定,切换至中期卡池,前期剩余卡牌转入 | 回合循环步骤1 |
| 游戏阶段 | 后期:已放置核心卡牌≥31张 + 低碳总分≥101 或 剩余核心卡牌≤10张 | 每回合开始时判定,切换至后期卡池,中期剩余卡牌转入 | 回合循环步骤1 |
| 随机发牌 | 基础:前期每回合4张、中期每回合3张、后期每回合2张核心卡;已解锁政策卡≥1时,额外1张政策卡 | 回合循环步骤2,手牌上限:核心卡6张、政策卡2张 | 回合循环步骤2 |
| 核心卡概率 | 某板块已放置≥40%→概率-10%;≤10%→概率+10% | 每回合发牌前执行,按当前阶段卡池概率抽取 | 3.2.2 概率调整 |
| 特殊场景 | 卡池耗尽→下一阶段补充;剩余核心卡≤抽牌数量→抽牌数量=剩余数量 | 抽牌阶段自动处理,重连后恢复抽牌状态 | 3.2.3 特殊场景 |
| 核心卡牌放置 | 1. 目标地块空白;2. 核心资源满足卡牌消耗要求 | 回合循环步骤3,失败则卡牌返回手牌,不消耗资源 | 3.3.2 放置判定 |
| 政策卡解锁 | 《低碳产业补贴政策》:工业卡牌≥6张 + 产业值≥50 | 实时判定,解锁后加入政策卡库,可参与抽牌、使用 | 3.4 政策卡解锁 |
| 政策卡解锁 | 《工业碳减排管控政策》:工业卡牌≥8张 + 碳排放≥100 | 实时判定,解锁后加入政策卡库,可参与抽牌、使用 | 3.4 政策卡解锁 |
| 政策卡解锁 | 《生态碳汇提升政策》:生态卡牌≥6张 + 绿建度≥70 | 实时判定,解锁后加入政策卡库,可参与抽牌、使用 | 3.4 政策卡解锁 |
| 政策卡解锁 | 《红树林保护专项政策》:生态深圳特色卡牌≥2张 | 实时判定,解锁后加入政策卡库,可参与抽牌、使用 | 3.4 政策卡解锁 |
| 政策卡解锁 | 《科创低碳扶持政策》:科学卡牌≥6张 + 科创点≥70 | 实时判定,解锁后加入政策卡库,可参与抽牌、使用 | 3.4 政策卡解锁 |
| 政策卡解锁 | 《碳捕捉技术推广政策》:科学≥5张 + 工业≥5张 + 科创点≥80 | 实时判定,解锁后加入政策卡库,可参与抽牌、使用 | 3.4 政策卡解锁 |
| 政策卡解锁 | 《甜甜圈社区建设政策》:人与社会≥5张 + 生态≥5张 + 满意度≥75 | 实时判定,解锁后加入政策卡库,可参与抽牌、使用 | 3.4 政策卡解锁 |
| 政策卡解锁 | 《市民低碳参与激励政策》:人与社会≥6张 + 人口≥60 | 实时判定,解锁后加入政策卡库,可参与抽牌、使用 | 3.4 政策卡解锁 |
| 政策卡使用 | 1. 已解锁;2. 当前回合未使用政策卡(标记=false) | 回合循环步骤4,每回合最多1张,使用后返回卡库可重复使用 | 3.3.3 使用判定 |
| 组合技触发 | 板块内:对应板块卡牌≥4张 + 满足相邻/标签要求(详见3.5.2) | 政策卡使用阶段结束后触发,每回合最多2种,效果持续1回合 | 3.5 组合技判定 |
| 组合技触发 | 跨板块:两板块卡牌各≥3张 + 满足相邻/标签要求(详见3.5.2) | 政策卡使用阶段结束后触发,每回合最多2种,效果持续1回合 | 3.5 组合技判定 |
| 组合技触发 | 卡牌+政策卡:解锁对应政策卡 + 对应板块卡牌≥3张 + 使用该政策卡 | 政策卡使用阶段结束后触发,每回合最多2种,效果持续1回合 | 3.5 组合技判定 |
| 特殊事件 | 触发条件:事件冷却≤0(每3回合),基础概率30% | 回合结算后触发,当前版本仅3种负向事件,效果持续1-2回合 | 3.6 特殊事件判定 |
| 特殊事件 | 化解方式:负向事件可通过对应政策卡使用立即抵消(详见3.6.2) | 触发后添加标签,化解后移除标签,终止效果 | 3.6 特殊事件判定 |
| 碳交易 | 配额消耗:碳排放>80时,消耗数量=向下取整((碳排放-80)/10) | 回合结算时处理,配额不足仅标记,不额外惩罚 | 3.7.2 配额消耗 |
| 碳交易 | 交易窗口:每2回合开启1次(回合2、4、6...),当回合内不限时可选交易 | 事件判定后标记可交易状态,结束回合仍未交易视为放弃 | 3.7.2 交易窗口 |
| 碳交易 | 交易价格:2×(1±20%)×(1±碳排放影响10%),保留1位小数 | 交易窗口开启时计算,碳排放>100+10%,<60-10% | 3.7.2 价格计算 |
| 结局校验 | 当前版本仅4类结局(创新科技/生态优先/甜甜圈/失败) | 结局校验时按固定优先级判定,并绑定对应结局图片 | 2.5 结局规则 |
| 结局校验边界 | 剩余核心卡牌=0 或 当前回合=30 | 结局校验时触发终局判定,不满足正向结局则进入失败结局 | 2.2 步骤9 边界校验 |
| 效果优先级 | 特殊事件效果 > 政策卡效果 > 组合技效果 > 核心卡牌基础效果 | 回合结算时按优先级计算,同优先级正负抵消、正向叠加 | 3.3.4 优先级判定 |

## 六、用户故事(已并入总需求)

### 6.1 核心用户画像

1. 新手玩家: 首次接触模拟经营/卡牌玩法,需要低门槛引导。
2. 中度玩家: 关注策略深度、数值平衡和结局成就。
3. 轻度玩家: 单次10-15分钟,希望回合节奏快、操作简单。

### 6.2 用户故事清单

1. 用户故事1(开局引导): 进入新游戏后可分步引导且可跳过,帮助理解首回合操作。
2. 用户故事2(卡牌信息提示): 点击核心/政策卡时展示消耗、基础效果、所属板块。
3. 用户故事3(核心卡放置反馈): 放置成功/失败即时反馈,失败原因明确(地块占用/资源不足)。
4. 用户故事4(政策卡解锁与使用): 达成条件后明显提示解锁,使用时反馈成功/失败(未解锁/本回合已使用)。
5. 用户故事5(组合技提示): 放置后触发组合技时,展示组合技名称与核心效果。
6. 用户故事6(碳交易操作): 每2回合展示可交易状态与碳价、可交易数量、配额,当回合内不限时可选交易,交易后即时反馈结果。
7. 用户故事7(事件触发与化解): 触发负向事件时显示效果与持续时间,并明确可用政策卡化解方式。
8. 用户故事8(结局展示与复盘): 结局页展示结局名称、达成条件及核心复盘数据。
9. 用户故事9(手牌弃置引导): 超上限时提示弃置并阻断其他操作,玩家手动弃置后恢复正常操作。
10. 用户故事10(重连恢复): 异常重连后恢复回合、手牌、资源、效果持续与事件冷却状态。

### 6.3 用户故事验收关注点

1. 判定与交易响应时间: 核心交互目标≤0.5秒。
2. 重连恢复时间: 目标≤1秒。
3. 所有提示弹窗不遮挡核心操作区域,且信息简洁可读。
4. 复盘数据必须与全局变量一致,不得出现结算偏差。
5. 开发落地优先级: 开局引导 -> 核心玩法 -> 事件与结局 -> 体验优化。
