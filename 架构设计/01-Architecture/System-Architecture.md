# 系统整体架构（System Architecture）

## 1. 架构风格

- 模块化单体（Modular Monolith）
- API 服务与 Worker 服务解耦
- 同一代码规范，不同运行职责

说明：
- API 服务负责「对外请求 + 实时响应」
- Worker 服务负责「异步任务 + 定时任务 + 重计算」

---

## 2. 系统组件总览

### 2.1 前端（Web）
- 技术：Next.js
- 职责：
  - 页面渲染
  - 用户交互
  - 调用后端 API
- 不做业务逻辑判断

---

### 2.2 后端 API 服务（Spring Boot）

**核心职责**
- 用户认证与授权
- 内容 / 活动 / 评论 / 积分 的 CRUD
- 搜索接口
- 即时业务校验（如报名必填）

**特点**
- 同步 HTTP 请求
- 低延迟
- 不执行长耗时任务

---

### 2.3 后端 Worker 服务（Spring Boot Job）

**核心职责**
- 爬虫抓取活动/新闻
- 每日任务 & 签到刷新（10:00）
- 积分结算
- 推荐计算
- 搜索索引更新

**特点**
- 无对外 HTTP 接口
- 通过消息队列/定时器触发
- 允许延迟执行

---

### 2.4 数据存储

#### PostgreSQL
- 核心业务数据
- 强事务一致性
- 支持全文搜索（FTS）

#### Redis
- 验证码
- 登录态
- 热点计数（点赞、评论数）
- 限流
- 临时任务状态

#### 对象存储（S3 / MinIO）
- 用户头像
- 活动海报
- 新闻图片

---

## 3. 同步与异步边界

### 同步（API 即时完成）
- 登录 / 注册
- 浏览内容
- 提交评论
- 点赞 / 收藏
- 报名活动

### 异步（Worker 后台完成）
- 更新统计数（点赞数、评论数）
- 计算评论热度
- 发放积分
- 更新推荐结果
- 爬虫抓取与去重

---

## 4. 系统通信方式

- 前端 → API：HTTP（REST）
- API → DB：JPA / MyBatis
- API → Redis：缓存 / 原子计数
- API → Queue：事件投递
- Worker → DB：批量写入
- Worker → Redis：状态更新

---

## 5. 关键架构原则

- 写请求尽量短
- 统计数据异步化
- 用户行为事件化
- 所有可计算结果都可重算
